services:
  streamonitor:
# If you want to build locally, use this instead the image line below:
    build: ./
    # image: streamonitor:latest

    # image: ghcr.io/lossless1024/streamonitor:latest

    restart: unless-stopped
    # Give time for graceful shutdown: stop all recordings (flush/close files) before container is killed
    stop_grace_period: 300s
    environment:
      # set timzeone
      #TZ: Etc/UTC
      # unset password (admin by default)
      #STRMNTR_PASSWORD: ''
      # unbind web interface (bound to 127.0.0.1 by default)
      STRMNTR_HOST: '0.0.0.0'
      # change confirm delete behavior: disable
      #STRMNTR_CONFIRM_DEL: ""
      # change confirm delete behavior: always-on
      #STRMNTR_CONFIRM_DEL: "True"
      STRMNTR_CONFIRM_DEL: "MOBILE"
      # enable theater mode
      #STRMNTR_THEATER_MODE: "True
      # set refresh frequency on streamer page
      STRMNTR_STATUS_FREQ: "5"
      # set refresh frequency on list page
      STRMNTR_LIST_FREQ: "30"
      # Web UI skin
      # Available options:
      # - kseen715 - 2nd skin, currently broken
      # - truck-kun (default) - 3rd skin, row oriented
      # - shaftoverflow - 4th skin, card layout, links in menus
      STRMNTR_SKIN: "shaftoverflow"
      # Set segment size for video splitting (in bytes or with units: K, M, G)
      # Example: "838860800" (800 MB in bytes), "800M" (800 MB), "1G" (1 GB)
      # If not set, videos will be downloaded as a single file
      STRMNTR_SEGMENT_SIZE: "1G"
      # HLS resiliency: tolerate short transient disconnects without splitting into many short files
      # During this grace window, playlist/chunk failures will be retried instead of ending the recording.
      STRMNTR_HLS_GRACE_SECONDS: "80"
      # Sleep between transient retries (reduce log spam by increasing this)
      STRMNTR_HLS_RETRY_SLEEP: "5"
    volumes:
      - ./downloads:/app/downloads
      - ./config.json:/app/config.json
      - ./stripchat_mouflon_keys.json:/app/stripchat_mouflon_keys.json
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - '5000:5000'

